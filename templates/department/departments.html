{% extends "baseIndex.html" %}
{% block title %}Danh sách phòng ban{% endblock %}

{% block content %}
<style>
  /* ===== Card bọc + toolbar (tùy chọn) ===== */
  .table-shell{
    border:1px solid var(--bs-border-color);
    border-radius:16px;
    background: var(--bs-body-bg);
    box-shadow: 0 6px 20px rgba(0,0,0,.06);
    overflow:hidden;
  }
  .table-toolbar{
    display:flex; gap:.75rem; align-items:center; justify-content:space-between;
    padding:.85rem 1rem; border-bottom:1px solid var(--bs-border-color);
    background: linear-gradient(180deg, rgba(35,47,74,.03), transparent);
  }
  .toolbar-right{ display:flex; gap:.5rem; align-items:center; }
  .search-wrap{ position:relative; }
  .search-wrap .bi-search{ position:absolute; left:.65rem; top:50%; transform:translateY(-50%); opacity:.55; }
  .search-input{ padding-left:2rem; min-width:240px; }


  @media (max-width: 576px){
    .table-toolbar{ flex-direction:column; align-items:stretch; }
    .search-input{ min-width:160px; }
  }
</style>

<div class="container mt-4">
  <h2 class="mb-3 fw-bold">Danh sách phòng ban</h2>

  <div class="table-shell">
    <!-- Toolbar (không đổi logic) -->
    <div class="table-toolbar">
      <a href="{{ url_for('department_web.departments_add') }}"
         class="btn btn-primary btn-pill px-3 shadow-sm">
        <i class="bi bi-plus-circle me-1"></i> Thêm phòng ban
      </a>
      <div class="toolbar-right">
        <div class="search-wrap">
          <i class="bi bi-search"></i>
          <input id="tableSearch" type="search" class="form-control form-control-sm search-input"
                 placeholder="Tìm mã hoặc tên...">
        </div>
      </div>
    </div>

    <div class="table-responsive">
      <table id="deptTable" class="table table-soft table-hover table-bordered align-middle">
        <thead>
          <tr>
            <th style="width:7%">STT</th>
            <th style="width:18%">Mã</th>
            <th>Tên</th>
            <th style="width:20%">Thao tác</th>
          </tr>
        </thead>
        <tbody>
          {% for d in departments %}
          <tr>
            <td>{{ loop.index }}</td>
            <td><span class="code-badge">{{ d.code }}</span></td>
            <td>
              <div class="d-flex align-items-center gap-2">
                <span class="avatar-circle">{{ d.name[:1] if d.name else '?' }}</span>
                <span class="fw-semibold">{{ d.name }}</span>
              </div>
            </td>
            <td>
              <a href="{{ url_for('department_web.departments_edit', dept_id=d.id) }}"
                 class="btn btn-sm btn-warning btn-pill me-1">
                <i class="bi bi-pencil-square"></i> Sửa
              </a>
              <form method="post"
                    action="{{ url_for('department_web.departments_delete', dept_id=d.id) }}"
                    class="d-inline"
                    onsubmit="return confirm('Xóa phòng ban {{ d.code }}?');">
                <button type="submit" class="btn btn-sm btn-danger btn-pill">
                  <i class="bi bi-trash"></i> Xóa
                </button>
              </form>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="4" class="text-center text-secondary py-5">
              <i class="bi bi-inboxes me-1"></i> Không có dữ liệu
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Live search đơn giản, không đổi backend -->
<script>
  function vnNormalize(s){
    return (s||"").toString()
      .normalize('NFD').replace(/\p{Diacritic}/gu,'')
      .toLowerCase().trim();
  }
  (function(){
    const input = document.getElementById('tableSearch');
    const rows  = () => Array.from(document.querySelectorAll('#deptTable tbody tr'));
    input?.addEventListener('input', function(){
      const q = vnNormalize(this.value);
      rows().forEach(tr => {
        const code = vnNormalize(tr.cells[1]?.innerText);
        const name = vnNormalize(tr.cells[2]?.innerText);
        tr.style.display = (!q || code.includes(q) || name.includes(q)) ? '' : 'none';
      });
    });
  })();
</script>
{% endblock %}
